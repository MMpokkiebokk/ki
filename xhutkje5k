game = cloneref(game)
local Workspace = game:GetService("Workspace") 
local function gs(service) return game:GetService(service) end
local _tweenservice, _runservice, _coregui, _uis, _http = gs("TweenService"), gs("RunService"), gs("CoreGui"), gs("UserInputService"), gs("HttpService")
local mouse = gs("Players").LocalPlayer:GetMouse()
local ab = {}

local Library = {
    Ui_Bind = Enum.KeyCode.RightShift,
    Colors = {
        Window = Color3.fromRGB(9, 9, 9),
        BorderColor = Color3.fromRGB(40, 40, 40),
        Accent = Color3.fromRGB(139, 158, 252),
        TopBar = Color3.fromRGB(9, 9, 9),
        TopText = Color3.fromRGB(100,100,100),
        TabContainer = Color3.fromRGB(9, 9, 9),
        TabActive = Color3.fromRGB(200, 200, 200),
        TabInactive = Color3.fromRGB(100, 100, 100),
        ContentContainer = Color3.fromRGB(9, 9, 9),
        Section = Color3.fromRGB(9, 9, 9),
        SectionText = Color3.fromRGB(150,150,150),
        RiskyActive = Color3.fromRGB(200, 0, 0),
        RiskyInactive = Color3.fromRGB(100, 0, 0),
        ElementActive = Color3.fromRGB(125, 125, 125),
        ElementInactive = Color3.fromRGB(80, 80, 80),
    },
    Instances = {},
    Connections = {},
    Font = nil,
}

-- Font registration function
function Library:Register_Font(Name, Weight, Style, Asset)
    if not isfile(Asset.Id) then writefile(Asset.Id, Asset.Font) end
    if isfile(Name .. ".font") then delfile(Name .. ".font") end
    local Data = {
        name = Name,
        faces = {
            {
                name = "Regular",
                weight = Weight,
                style = Style,
                assetId = getcustomasset(Asset.Id),
            },
        },
    }
    writefile(Name .. ".font", _http:JSONEncode(Data))
    return getcustomasset(Name .. ".font")
end

-- Helper functions
function Library:Create(Class, Properties, Secure)
    local _Instance
    if Secure then
        _Instance = cloneref(Instance.new(Class))
    else 
        _Instance = type(Class) == 'string' and Instance.new(Class) or Class 
    end
    for Property, Value in next, Properties do
        _Instance[Property] = Value
    end
    table.insert(self.Instances, _Instance)
    return _Instance
end

function Library:validate(defaults, options)
    for i,v in pairs(defaults) do
        if options[i] == nil then
            options[i] = v
        end
    end
    return options
end

function Library:connection(signal, callback, tbl)
    local connection = signal:Connect(callback)
    table.insert(self.Connections, connection)
    if tbl then table.insert(tbl, connection) end
    return connection
end

function Library:unload()
    for _,v in next, self.Instances do 
        if v and v.Parent then 
            v:Destroy() 
        end 
    end
    for _,v in next, self.Connections do 
        if v then 
            v:Disconnect() 
        end 
    end
end

function Library:tween(object, goal, callback)
    local tween = _tweenservice:Create(object, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut), goal)
    if callback then
        tween.Completed:Connect(callback)
    end
    tween:Play()
end

function lerp(startValue, endValue, duration, callback)
    local startTime = tick()
    local completed = false
    task.spawn(function()
        while true do
            local currentTime = tick() - startTime
            if currentTime >= duration then
                callback(endValue)
                completed = true
                break
            end
            local progress = currentTime / duration
            local lerped = startValue + (endValue - startValue) * (1 - (1 - progress) * (1 - progress))
            callback(lerped)
            task.wait()
        end
    end)
    while not completed do
        task.wait()
    end
end

local SCREENGUI
local MarketplaceService = game:GetService("MarketplaceService")
local SoundService = game:GetService("SoundService")
local productInfo = MarketplaceService:GetProductInfo(game.PlaceId)
local gameName = productInfo.Name
local dropdownindex = 50

ab.AddWindow = function (options)
    local options = options or {}
    options = Library:validate({
        name = string.format('<font color="rgb(%d, %d, %d)">Funny.KM</font> | @Kdyriz', Library.Colors.Accent.R * 255, Library.Colors.Accent.G * 255, Library.Colors.Accent.B * 255),
        size = UDim2.new(0, 625, 0, 400),
        WaterMark = {
            Enabled = true, 
            TextSize = 9,
            TextTransparency = 0,
            TextStrokeTransparency = 0,
        },
    }, options or {})
    
    local menu = {CurrentTab = nil}
    
    SCREENGUI = Library:Create("ScreenGui", {
        Parent = _coregui,
        ZIndexBehavior = Enum.ZIndexBehavior.Global,
        Name = options.name
    }, true)

    -- Watermark setup
    local WATERMARK_FRAME = Library:Create("Frame", {
        Name = "WatermarkFrame",
        Parent = SCREENGUI,
        AutomaticSize = Enum.AutomaticSize.XY,
        Position = UDim2.new(0.5, 0, 0, 5),
        AnchorPoint = Vector2.new(0.5, 0),
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 0.5,
        BackgroundColor3 = Library.Colors.Window,
        Visible = true,
    })
    
    local WATERMARK_TEXT = Library:Create("TextButton", {
        Name = "WatermarkText",
        Parent = WATERMARK_FRAME,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        AutomaticSize = Enum.AutomaticSize.XY,
        Position = UDim2.new(0, 0, 0, 0),
        FontFace = Library.Font,
        TextSize = options.WaterMark.TextSize,
        TextTransparency = options.WaterMark.TextTransparency,
        TextStrokeTransparency = options.WaterMark.TextStrokeTransparency,
        TextXAlignment = Enum.TextXAlignment.Center,
        RichText = true,
        TextColor3 = Library.Colors.Accent,
        Text = "Watermark Loading...",
    })
    
    Library:Create("UIPadding", {
        Parent = WATERMARK_FRAME,
        PaddingBottom = UDim.new(0, 3),
        PaddingLeft = UDim.new(0, 3),
        PaddingRight = UDim.new(0, 3),
        PaddingTop = UDim.new(0, 3),
    })
    
    -- Main window setup
    local WINDOW = Library:Create("Frame", {
        Parent = SCREENGUI,
        Size = options.size,
        AnchorPoint = Vector2.new("0.5","0.5"),
        Position = UDim2.new(0.5, -100, 0.5, 0),
        BackgroundColor3 = Library.Colors.Window,
        BorderSizePixel = 0,
        Name = "Window",
        ZIndex = -2,
    })
    
    local originalBorderColor = Library.Colors.BorderColor
    local originalTextColor = Color3.fromRGB(255, 255, 255)
    local isHovering = false
    
    -- Watermark interactions
    Library:connection(WATERMARK_TEXT.MouseEnter, function()
        isHovering = true
        Library:tween(WATERMARK_TEXT, {BorderColor3 = originalBorderColor, TextColor3 = originalTextColor})
    end)
    
    Library:connection(WATERMARK_TEXT.MouseLeave, function()
        isHovering = false
        Library:tween(WATERMARK_TEXT, {BorderColor3 = Library.Colors.Accent, TextColor3 = Library.Colors.Accent})
    end)
    
    Library:connection(WATERMARK_TEXT.MouseButton1Click, function()
        WINDOW.Visible = not WINDOW.Visible
        if not WINDOW.Visible and not isHovering then
            Library:tween(WATERMARK_TEXT, {BorderColor3 =  originalBorderColor, TextColor3 = originalTextColor})
        end
    end)
    
    -- Window outline
    local WINDOW_OUTLINE = Library:Create("Frame", {
        Parent = WINDOW,
        Size = UDim2.new(1,-2,1,-2),
        AnchorPoint = Vector2.new("0.5","0.5"),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        BackgroundTransparency = 1,
        Name = "Outline",
        ZIndex = -1,
    })
    
    Library:Create("UIStroke", { 
        Parent = WINDOW_OUTLINE,
        Color = Library.Colors.BorderColor,
        LineJoinMode = Enum.LineJoinMode.Miter,
    })
    
    -- Modal background
    Library:Create("TextButton", {
        Parent = WINDOW,
        Size = UDim2.new(0, 1, 0, 1),
        BackgroundTransparency = 1,
        TextTransparency = 1,
        BorderSizePixel = 0,
        Name = "mb",
        Modal = true
    })
    
    -- Topbar setup
    local TOPBAR = Library:Create("Frame", {
        Parent = WINDOW,
        BackgroundColor3 = Library.Colors.TopBar,
        BorderSizePixel = 0,
        Size = UDim2.new(1, -6, 0, 18),
        Position = UDim2.new(0,3,0,3),
        Name = "Topbar"
    })
    
    Library:Create("Frame", { 
        Parent = TOPBAR,
        BackgroundColor3 = Library.Colors.Accent,
        BorderSizePixel = 0,
        Size = UDim2.new(1,4,0,1),
        Position = UDim2.new(0.5,0,1,1),
        AnchorPoint = Vector2.new(0.5,1),
    })
    
    local TOP_OVERLAY = Library:Create("Frame", {
        Parent = TOPBAR,
        BackgroundColor3 = Library.Colors.Accent,
        BorderSizePixel = 0,
        Size = UDim2.new(1,4,1,0),
        Position = UDim2.new(0.5,0,1,2),
        AnchorPoint = Vector2.new(0.5,1),
        ZIndex = 2
    })
    
    Library:Create("UIGradient", { 
        Parent = TOP_OVERLAY,
        Transparency = NumberSequence.new({
            NumberSequenceKeypoint.new(0, 1),
            NumberSequenceKeypoint.new(0.8, 0.7),
            NumberSequenceKeypoint.new(1, 1.0),
        }),
        Rotation = 90
    })
    
    Library:Create("TextLabel", { 
        Parent = TOPBAR,
        Size = UDim2.new(0, 0, 1, 0),
        Position = UDim2.new(0,6,0,0),
        TextColor3 = Library.Colors.TopText,
        BorderSizePixel = 0,
        TextSize = 9,
        RichText = true,
        Text = options.name,
        FontFace = Library.Font,
        TextXAlignment = Enum.TextXAlignment.Left,
        Name = "Title"
    })
    
    Library:Create("TextLabel", { 
        Parent = TOPBAR,
        Size = UDim2.new(0, 0, 1, 0),
        Position = UDim2.new(1,-6,0,0.5),
        AnchorPoint = Vector2.new(1,0.5),
        TextColor3 = Library.Colors.TopText,
        BorderSizePixel = 0,
        TextSize = 9,
        RichText = true,
        Text = string.lower(os.date("%A, %d %B, %y")),
        FontFace = Library.Font,
        TextXAlignment = Enum.TextXAlignment.Right,
        Name = "Title"
    })
    
    -- Tab container setup
    local TABCONTAINER = Library:Create("Frame", {
        Parent = WINDOW,
        BackgroundTransparency = 1,
        Size = UDim2.new(0,120,1,-35),
        Position = UDim2.new(0,10,0.5,10),
        AnchorPoint = Vector2.new(0,0.5),
        Name = "TabContainer"
    })
    
    Library:Create("UIPadding", { 
        Parent = TABCONTAINER,
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    
    Library:Create("UIListLayout", { 
        Parent = TABCONTAINER,
        SortOrder = Enum.SortOrder.LayoutOrder,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Top,
        Padding = UDim.new(0, 8),
    })
    
    Library:Create("UIStroke", { 
        Parent = TABCONTAINER,
        Color = Library.Colors.BorderColor
    })
    
    -- Inner container setup
    local INNERCONTAINER = Library:Create("Frame", {
        Parent = WINDOW,
        Size = UDim2.new(1, -150, 1, -35),
        Position = UDim2.new(0, 140, 0, 28),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Name = "InnerContainer",
    })
    
    Library:Create("UIStroke", { 
        Parent = INNERCONTAINER,
        Color = Library.Colors.BorderColor,
        LineJoinMode = Enum.LineJoinMode.Miter,
    })
    
    -- Tab deactivation function
    local function deactivate(tab)
        for _, content in ipairs(INNERCONTAINER:GetChildren()) do
            if content.Name == tab.Name then
                content.Visible = false
            end
        end
        Library:tween(tab.TabText, {Position = UDim2.new(0,12,0.5,0),})
        Library:tween(tab.TabBar, {Position = UDim2.new(0,0,0.5,0),})
        Library:tween(tab.TabOverlay, {Position = UDim2.new(0,0,0,0)})
        Library:tween(tab.TabText, {TextColor3 = Library.Colors.TabInactive})
        Library:tween(tab.TabOverlay, {BackgroundTransparency = 1})
    end
    
    -- Watermark functionality
    local watermarkStartTime = os.clock()
    
    function Library:WatermarkTextTriggers(text)
        local AccentColor = Library.Colors.Accent
        local elapsed = os.clock() - watermarkStartTime
        local mins = math.floor(elapsed / 60)
        local secs = math.floor(elapsed % 60)
    
        local Triggers = {
            ['{user}'] = game.Players.LocalPlayer.Name,
            ['{ServerTime}'] = Workspace:GetServerTimeNow(),
            ['{name}'] = ('<font color="rgb(%s, %s, %s)">Funny.KM</font>'):format(
                math.floor(AccentColor.R * 255),
                math.floor(AccentColor.G * 255),
                math.floor(AccentColor.B * 255)
            ),
            ['{hour}'] = os.date("%H"),
            ['{minute}'] = os.date("%M"),
            ['{second}'] = os.date("%S"),
            ['{ap}'] = os.date("%p"),
            ['{month}'] = os.date("%b"),
            ['{day}'] = os.date("%d"),
            ['{year}'] = os.date("%Y"),
            ['{fps}'] = tostring(math.floor(1 / game:GetService("RunService").RenderStepped:Wait())),
            ['{ping}'] = tostring(math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue() or 0)),
            ['{time}'] = os.date("%H:%M:%S"),
            ['{date}'] = os.date("%b. %d, %Y"),
            ['{usage}'] = string.format("%dm %ds", mins, secs),
        }
    
        for key, value in pairs(Triggers) do
            text = text:gsub(key, value)
        end
        return text
    end
 
    -- Watermark update system
    local watermarkContent = "{name} |User: {user} | Usage: {usage} | Ping: {ping}ms | Fps: {fps} |RealTime : {time} | Date: {date} | ServerTime: {ServerTime} "
    local watermarkTick = 0.1
    local watermarkLastUpdate = os.clock()
    
    function Library:SetWatermarkContent(newText)
        watermarkContent = newText
    end
    
    function Library:SetWatermarkUpdateRate(rate)
        watermarkTick = rate
    end
    
    function Library:ToggleWatermark(visible)
        WATERMARK_FRAME.Visible = visible
    end
    
    Library:connection(game:GetService("RunService").RenderStepped, function()
        local now = os.clock()
        if now - watermarkLastUpdate >= watermarkTick then
            watermarkLastUpdate = now
            WATERMARK_TEXT.Text = Library:WatermarkTextTriggers(watermarkContent)
        end
        if options.WaterMark.Enabled then 
            Library:ToggleWatermark(true)
        else
            Library:ToggleWatermark(false)
        end 
    end)
    
    -- Tab creation function
    function menu:AddTab(options)
        options = Library:validate({
            name = "example"
        }, options or {})
        
        local tab = {}
        
        local TAB = Library:Create("Frame", {
            Parent = TABCONTAINER,
            BackgroundTransparency = 1,
            Size = UDim2.new(1,0,0,15),
            Name = options.name
        })
        
        local TAB_OVERLAY = Library:Create("Frame", {
            Parent = TAB,
            Size = UDim2.new(1,0,1,0),
            BackgroundTransparency = 1,
            BackgroundColor3 = Library.Colors.Accent,
            Name = "TabOverlay"
        })
        
        Library:Create("UIGradient", { 
            Parent = TAB_OVERLAY,
            Transparency = NumberSequence.new({
                NumberSequenceKeypoint.new(0, 0.8),
                NumberSequenceKeypoint.new(0.4, 1),
                NumberSequenceKeypoint.new(1, 1),
            }),
        })
        
        local TABBAR = Library:Create("Frame", {
            Parent = TAB,
            BackgroundColor3 = Library.Colors.Accent,
            Size = UDim2.new(0,1,1,0),
            Position = UDim2.new(0,0,0.5,0),
            AnchorPoint = Vector2.new(0,0.5),
            Name = "TabBar"
        })
        
        local TABTEXT = Library:Create("TextLabel", {
            Parent = TAB,
            BackgroundTransparency = 1,
            Size = UDim2.new(1,-12,1,0),
            Position = UDim2.new(0,12,0.5,0),
            AnchorPoint = Vector2.new(0,0.5),
            TextColor3 = Library.Colors.TabInactive,
            FontFace = Library.Font,
            TextSize = 9,
            TextXAlignment = Enum.TextXAlignment.Left,
            Text = options.name,
            Name = "TabText"
        })
        
        -- Tab content container
        local CONTENTCONTAINER = Library:Create("Frame", {
            Parent = INNERCONTAINER,
            Size = UDim2.new(1, 0, 1, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Visible = false,
            Name = options.name
        })
        
        local LEFTCONTAINER = Library:Create("Frame", {
            Parent = CONTENTCONTAINER,
            Size = UDim2.new(0.5, -6, 1, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Name = "LeftContainer"
        })
        
        Library:Create("UIPadding", {
            Parent = LEFTCONTAINER,
            PaddingTop = UDim.new(0,10),
            PaddingBottom = UDim.new(0,10),
            PaddingLeft = UDim.new(0,10),
        })
        
        local RIGHTCONTAINER = Library:Create("Frame", {
            Parent = CONTENTCONTAINER,
            Size = UDim2.new(0.5, -6, 1, 0),
            AnchorPoint = Vector2.new(1, 0),
            Position = UDim2.new(1, 0, 0, 0),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Name = "RightContainer"
        })
        
        Library:Create("UIPadding", {
            Parent = RIGHTCONTAINER,
            PaddingTop = UDim.new(0,10),
            PaddingBottom = UDim.new(0,10),
            PaddingRight = UDim.new(0,10),
        })
        
        -- Tab functionality
        local function Activate()
            CONTENTCONTAINER.Visible = true
            
            Library:tween(TABTEXT, {Position = UDim2.new(0,18,0.5,0),})
            Library:tween(TABBAR, {Position = UDim2.new(0,6,0.5,0),})
            Library:tween(TAB_OVERLAY, {Position = UDim2.new(0,6,0,0),})
            Library:tween(TABTEXT, {TextColor3 = Library.Colors.TabActive})
            Library:tween(TABBAR, {BackgroundTransparency = 0})
            menu.CurrentTab = TAB
        end
        
        local function switchTab(tab)
            Library:tween(TABTEXT, {TextColor3 = Library.Colors.TabActive})
            Library:tween(TAB_OVERLAY, {BackgroundTransparency = 0})
            for _, content in pairs(TABCONTAINER:GetChildren()) do
                if content:IsA("Frame") and content.Name ~= tab.Name then
                    deactivate(content)
                end
            end
            Activate(tab)
        end
        
        Library:connection(TAB.MouseEnter, function()
            if menu.CurrentTab ~= TAB then 
                Library:tween(TABTEXT, {TextColor3 = Library.Colors.TabActive}) 
            end
            local input = Library:connection(_uis.InputBegan, function(key)
                if key.UserInputType == Enum.UserInputType.MouseButton1 or key.UserInputType == Enum.UserInputType.Touch then
                    switchTab(TAB)
                end
            end)
            local leave
            leave = Library:connection(TAB.MouseLeave, function()
                if menu.CurrentTab ~= TAB then 
                    Library:tween(TABTEXT, {TextColor3 = Library.Colors.TabInactive}) 
                end
                input:disconnect()
                leave:disconnect()
            end)
        end)
        
        if menu.CurrentTab == nil then
            switchTab(TAB)
        end
        
        -- Sub-tab functionality
        local SUBTABCONTAINER
        local LeftHeight = {}
        local RightHeight = {}
        local NewPos = 0
        getgenv().subtab = false
        
        local function subdeactivate(subtab)
            local ContentContainer = INNERCONTAINER[subtab.Parent.Parent.Name]
            for _, content in ipairs(ContentContainer:GetChildren()) do
                if content.Name == subtab.Name then
                    content.Visible = false
                end
            end
            Library:tween(subtab.SubTabText, {TextColor3 = Library.Colors.TabInactive})
            Library:tween(subtab.SubTabBar, {BackgroundTransparency = 1})
        end
        
        function tab:AddTab(options)
            options = Library:validate({
                name = "preview",
            }, options or {})
            
            local tab = {CurrentTab = nil}
            getgenv().subtab = true
            local SUBLEFTCONTAINER  = LEFTCONTAINER:Clone()
            local SUBRIGHTCONTAINER = RIGHTCONTAINER:Clone()
        
            if LEFTCONTAINER and RIGHTCONTAINER then
                LEFTCONTAINER:Destroy()
                RIGHTCONTAINER:Destroy()
            end
            
            if not SUBLEFTCONTAINER:FindFirstChild("UIPadding") then
                Library:Create("UIPadding", {
                    Parent = SUBLEFTCONTAINER,
                    PaddingTop = UDim.new(0,10),
                    PaddingBottom = UDim.new(0,10),
                    PaddingLeft = UDim.new(0,10),
                })
            end
            
            if not SUBRIGHTCONTAINER:FindFirstChild("UIPadding") then
                Library:Create("UIPadding", {
                    Parent = SUBRIGHTCONTAINER,
                    PaddingTop = UDim.new(0,10),
                    PaddingBottom = UDim.new(0,10),
                    PaddingRight = UDim.new(0,10),
                })
            end
            
            if not CONTENTCONTAINER:FindFirstChild("SubTabContainer") then
                SUBTABCONTAINER = Library:Create("Frame", {
                    Parent = CONTENTCONTAINER,
                    Size = UDim2.new(1,0,0,20),
                    Name = "SubTabContainer"
                })
        
                Library:Create("UIListLayout", {
                    Parent = SUBTABCONTAINER,
                    FillDirection = Enum.FillDirection.Horizontal,
                    VerticalAlignment = Enum.VerticalAlignment.Center,
                    SortOrder = Enum.SortOrder.LayoutOrder,
                })
                
                Library:Create("UIStroke", {
                    Parent = SUBTABCONTAINER,
                    Color = Library.Colors.BorderColor
                })
                
                Library:Create("UIGradient", { 
                    Parent = SUBTABCONTAINER,
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(30, 30, 30)),
                        ColorSequenceKeypoint.new(0.7, Color3.fromRGB(Library.Colors.Section)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(Library.Colors.Section))
                    },
                    Transparency = NumberSequence.new({
                        NumberSequenceKeypoint.new(0, 0),
                        NumberSequenceKeypoint.new(0.85, 1),
                        NumberSequenceKeypoint.new(1, 1),
                    }),
                    Rotation = 90,
                })
            end
        
            local SUBTAB = Library:Create("Frame", {
                Parent = SUBTABCONTAINER,
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                Size = UDim2.new(1,0,1,0),
                Name = options.name
            })
            
            -- Fit tabs in container
            do
                local tabCount = 0
                for _, subtab in ipairs(SUBTABCONTAINER:GetChildren()) do
                    if subtab:IsA("Frame") then
                        tabCount = tabCount + 1
                    end
                end
                local finalValue = math.round(SUBTABCONTAINER.AbsoluteSize.X / tabCount)
                for _, subtab in ipairs(SUBTABCONTAINER:GetChildren()) do
                    if subtab:IsA("Frame") then
                        subtab.Size = UDim2.new(0, finalValue, 1, 0)
                    end
                end
            end
        
            local SUBTABTEXT = Library:Create("TextLabel", { 
                Parent = SUBTAB,
                BackgroundTransparency = 1,
                TextColor3 = Library.Colors.TabInactive,
                FontFace = Library.Font,
                TextSize = 9,
                Size = UDim2.new(1,0,1,0),
                Text = options.name,
                Name = "SubTabText"
            })
        
            local SUBTABBAR = Library:Create("Frame", {
                Parent = SUBTAB,
                BackgroundColor3 = Library.Colors.Accent,
                BackgroundTransparency = 1,
                BorderSizePixel = 0,
                AnchorPoint = Vector2.new(0.5,1),
                Position = UDim2.new(0.5,0,1,2),
                Size = UDim2.new(1,0,0,1),
                Name = "SubTabBar"
            })
        
            -- Sub-tab content container
            local SUBCONTENTCONTAINER = Library:Create("Frame", {
                Parent = CONTENTCONTAINER,
                BackgroundTransparency = 1,
                Visible = false,
                Position = UDim2.new(0,0,0,25),
                Size = UDim2.new(1,0,1,-25),
                Name = options.name
            })
            
            local LEFTCONTAINER = SUBLEFTCONTAINER
            local RIGHTCONTAINER = SUBRIGHTCONTAINER
            LEFTCONTAINER.Parent = SUBCONTENTCONTAINER
            RIGHTCONTAINER.Parent = SUBCONTENTCONTAINER
        
            LeftHeight[options.name] = {}
            RightHeight[options.name] = {}
            
            -- Sub-tab functionality
            do
                local function Activate()
                    SUBCONTENTCONTAINER.Visible = true
                
                    Library:tween(SUBTABTEXT, {TextColor3 = Library.Colors.TabActive})
                    Library:tween(SUBTABBAR, {BackgroundTransparency = 0})
                    tab.CurrentTab = SUBTAB
                end
                
                local function switchTab(subtab)
                    Library:tween(SUBTABTEXT, {TextColor3 = Library.Colors.TabActive})
                    Library:tween(SUBTABBAR, {BackgroundTransparency = 0})
                    for _, content in pairs(SUBTABCONTAINER:GetChildren()) do
                        if content:IsA("Frame") and content.Name ~= subtab.Name then
                            subdeactivate(content)
                        end
                    end
                    Activate(subtab)
                end
        
                Library:connection(SUBTAB.MouseEnter, function()
                    if tab.CurrentTab ~= SUBTAB then 
                        Library:tween(SUBTABTEXT, {TextColor3 = Library.Colors.TabActive}) 
                    end
                    local input = Library:connection(_uis.InputBegan, function(key)
                        if key.UserInputType == Enum.UserInputType.MouseButton1 or key.UserInputType == Enum.UserInputType.Touch then
                            switchTab(SUBTAB)
                        end
                    end)
                    local leave
                    leave = Library:connection(SUBTAB.MouseLeave, function()
                        if tab.CurrentTab ~= SUBTAB then 
                            Library:tween(SUBTABTEXT, {TextColor3 = Library.Colors.TabInactive}) 
                        end
                        input:disconnect()
                        leave:disconnect()
                    end)
                end)
        
                if tab.CurrentTab == nil then
                    switchTab(SUBTAB)
                end
            end
        
            return tab
        end
        
        -- Section creation function
        function tab:AddSection(options)
            options = Library:validate({
                tab = nil,
                name = "preview",
                side = "Left",
                height = "fill" -- fill, half,
            }, options or {})
            
            local section = { Hover = false, }
            local NewPos
        
            -- Calculate Section Position
            if options.side == "Left" then
                if getgenv().subtab then
                    local subtab = options.tab
                    if LeftHeight[subtab] and #LeftHeight[subtab] > 0 then
                        NewPos = LeftHeight[subtab][#LeftHeight[subtab]] + 30
                    else
                        NewPos = 15
                    end
                else
                    if LeftHeight and #LeftHeight > 0 then
                        NewPos = LeftHeight[#LeftHeight] + 30
                    else
                        NewPos = 15
                    end
                end
            else
                if getgenv().subtab then
                    local subtab = options.tab
                    if RightHeight[subtab] and #RightHeight[subtab] > 0 then
                        NewPos = RightHeight[subtab][#RightHeight[subtab]] + 30
                    else
                        NewPos = 15
                    end
                else
                    if RightHeight and #RightHeight > 0 then
                        NewPos = RightHeight[#RightHeight] + 30
                    else
                        NewPos = 15
                    end
                end
            end
        
            local SECTION = Library:Create("Frame", {
                Size = UDim2.new(1, 0, 0, options.height),
                AnchorPoint = Vector2.new(0, 0),
                BackgroundColor3 = Library.Colors.Section,
                Position = UDim2.new(0, 0, 0, NewPos - 12),
                BorderSizePixel = 0,
                Name = options.name
            })
        
            local SECTIONTEXT = Library:Create("TextLabel", {
                Parent = SECTION,
                AnchorPoint = Vector2.new(0.5,0),
                Position = UDim2.new(0.5,0,0,-6),
                BackgroundColor3 = Library.Colors.Section,
                BorderSizePixel = 0,
                TextColor3 = Library.Colors.SectionText,
                TextSize = 9,
                FontFace = Library.Font,
                Text = options.name,
                Name = "SectionText"
            })
            
            Library:connection(SECTIONTEXT:GetPropertyChangedSignal("TextBounds"), function() 
                SECTIONTEXT.Size = UDim2.new(0,SECTIONTEXT.TextBounds.X + 25,0,10) 
            end)
            
            local ELEMENTCONTAINER = Library:Create("Frame", {
                Parent = SECTION,
                Size = UDim2.new(1, 0, 1, -10),
                Position = UDim2.new(0, 0, 0, 10),
                BackgroundTransparency = 1,
                Name = "ElementContainer"
            })
    
            Library:Create("UIListLayout", { 
                Parent = ELEMENTCONTAINER,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 8)
            })
            
            Library:Create("UIPadding", { 
                Parent = ELEMENTCONTAINER,
                PaddingLeft = UDim.new(0,15),
                PaddingRight = UDim.new(0,15),
            })
            
            local pos = SECTION.Position.Y.Offset
            if options.height == "fill" then
                SECTION.Size = UDim2.new(1,0,1,-pos)
            elseif options.height == "half" then
                SECTION.Size = UDim2.new(1,0,0.5,-pos/2)
            end
        
            -- Handle side picking
            do
                if getgenv().subtab and options.side == "Right" then
                    local subtab = options.tab
                    SECTION.Parent = CONTENTCONTAINER:FindFirstChild(subtab):FindFirstChild("RightContainer")
                    table.insert(RightHeight[subtab], SECTION.AbsoluteSize.Y)
                elseif getgenv().subtab then
                    local subtab = options.tab
                    SECTION.Parent = CONTENTCONTAINER:FindFirstChild(subtab):FindFirstChild("LeftContainer")
                    table.insert(LeftHeight[subtab], SECTION.AbsoluteSize.Y)
                end
                if options.side == "Right" and not getgenv().subtab then
                    SECTION.Parent = RIGHTCONTAINER
                    table.insert(RightHeight,SECTION.AbsoluteSize.Y)
                elseif not getgenv().subtab then
                    SECTION.Parent = LEFTCONTAINER
                    table.insert(LeftHeight, SECTION.AbsoluteSize.Y)
                end
            end
        
            Library:Create("UIStroke", { 
                Parent = SECTION,
                Color = Library.Colors.BorderColor
            })
            
            -- Button element
            function section:AddButton(options)
                options = Library:validate({
                    name = "button",
                    callback = function() end,
                }, options or {})
                
                local BUTTONCONTAINER = Library:Create("Frame", {
                    Parent = ELEMENTCONTAINER,
                    Size = UDim2.new(1, 0, 0, 15),
                    Name = options.name,
                    BackgroundTransparency = 1
                })
                
                local BUTTON = Library:Create("Frame", {
                    Parent = BUTTONCONTAINER,
                    Size = UDim2.new(1, 0, 1, 0),
                    Position = UDim2.new(0, 0, 0, 0),
                    Name = "Button",
                    BackgroundColor3 = Color3.fromRGB(20, 20, 20),
                    BorderSizePixel = 1,
                    BorderColor3 = Library.Colors.BorderColor
                })
                
                Library:Create("UIGradient", {
                    Parent = BUTTON,
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
                        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(175, 175, 175)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(145, 145, 145))
                    },
                    Rotation = 90,
                })
                
                local BUTTONTITLE = Library:Create("TextLabel", {
                    Parent = BUTTON,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Library.Colors.ElementInactive,
                    TextSize = 9,
                    Text = options.name,
                    FontFace = Library.Font,
                    TextXAlignment = Enum.TextXAlignment.Center,
                    Name = "ButtonTitle"
                })
                
                -- Button functionality
                Library:connection(BUTTON.MouseEnter, function()
                    Library:tween(BUTTONTITLE, {TextColor3 = Library.Colors.ElementActive})
                    local input = Library:connection(_uis.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            options.callback()
                        end
                    end)
                    local leave
                    leave = Library:connection(BUTTON.MouseLeave, function()
                        input:Disconnect()
                        leave:Disconnect()
                        Library:tween(BUTTONTITLE, {TextColor3 = Library.Colors.ElementInactive})
                    end)
                end)
                
                return
            end
            
            -- Textbox element
            function section:AddTextbox(options)
                options = Library:validate({
                    name = "example textbox",
                    default = "Test",
                    callback = function() end,
                }, options or {})
                
                local TEXTBOX = Library:Create("Frame", {
                    Parent = ELEMENTCONTAINER,
                    Name = "textbox",
                    BackgroundColor3 = Color3.fromRGB(20,20,20),
                    BackgroundTransparency = 0,
                    BorderSizePixel = 1,
                    BorderColor3 = Library.Colors.BorderColor,
                    Size = UDim2.new(1, 0, 0, 15),
                    ZIndex = 10,
                })
                
                Library:Create("UIGradient", {
                    Parent = TEXTBOX,
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
                        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(175, 175, 175)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(145, 145, 145))
                    },
                    Rotation = 90,
                })
                
                local BACKGROUND = Library:Create("Frame", {
                    Parent = TEXTBOX,
                    Name = "BACKGROUND",
                    Position = UDim2.new(0, 0, 0, 0),
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 0,
                })
                
                local MAIN = Library:Create("ScrollingFrame", {
                    Parent = BACKGROUND,
                    Name = "main",
                    Active = true,
                    BackgroundColor3 = Color3.fromRGB(12, 12, 12),
                    BorderColor3 = Color3.fromRGB(0, 0, 0),
                    Size = UDim2.new(1, 0, 1, 0),
                    CanvasSize = UDim2.new(0, 0, 0, 0),
                    ScrollBarThickness = 0,
                })
                
                local BOX = Library:Create("TextBox", {
                    Name = "box",
                    Parent = MAIN,
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BackgroundTransparency = 1.0,
                    Selectable = false,
                    Size = UDim2.new(1, 0, 1, 0),
                    FontFace = Library.Font,
                    Text = options.default or "",
                    TextColor3 = Library.Colors.ElementInactive,
                    TextSize = 9,
                    TextStrokeTransparency = 0,
                    TextXAlignment = Enum.TextXAlignment.Center,
                    ZIndex = 10
                })
                
                -- Textbox functionality
                Library:connection(BOX.MouseEnter, function()
                    Library:tween(BOX, {TextColor3 = Library.Colors.ElementActive})
                end)
            
                Library:connection(BOX.MouseLeave, function()
                    Library:tween(BOX, {TextColor3 = Library.Colors.ElementInactive})
                end)
                
                Library:connection(BOX:GetPropertyChangedSignal("Text"), function()
                    options.name = BOX.Text
                end)
                
                Library:connection(BOX.FocusLost, function(enterPressed)
                    local text = BOX.Text
                    local callback_text = text ~= "" and text or options.default
                    
                    if enterPressed and options.callback then
                        options.callback(callback_text)
                    end
                end)
                
                return
            end
            
            -- Toggle element
            function section:AddToggle(options)
                options = Library:validate({
                    name = "example toggle",
                    default = false,
                    risky = false,
                    callback = function() end,
                }, options or {})
                
                local toggle = {
                    Hover = false,
                    State = options.default
                }
                
                local TOGGLECONTAINER = Library:Create("Frame", {
                    Size = UDim2.new(1,0,0,14),
                    Parent = ELEMENTCONTAINER,
                    BackgroundTransparency = 1,
                    Name = "ToggleContainer",
                })
                
                local TOGGLE = Library:Create("Frame", {
                    Parent = TOGGLECONTAINER,
                    Size = UDim2.new(0,9,0,9),
                    BackgroundColor3 = Color3.fromRGB(20, 20, 20),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Position = UDim2.new(0, 0, 0.5, 0),
                    Name = "Toggle",
                })
                
                Library:Create("UIGradient", { 
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
                        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(175, 175, 175)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(145, 145, 145))
                    },
                    Rotation = 90,
                    Parent = TOGGLE,
                })
                
                local TOGGLE_OUTLINE = Library:Create("UIStroke", {
                    Thickness = 1,
                    Color = Color3.fromRGB(0, 0, 0),
                    LineJoinMode = Enum.LineJoinMode.Miter,
                    Parent = TOGGLE,
                    Name = "UIStroke",
                })
                
                local TOGGLETITLE = Library:Create("TextLabel", {
                    Parent = TOGGLECONTAINER,
                    AnchorPoint = Vector2.new(0, 0.5),
                    Position = UDim2.new(0, 20, 0, 7),
                    BackgroundTransparency = 1,
                    TextSize = 9,
                    Text = options.name,
                    FontFace = Library.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Name = "ToggleTitle",
                })
                
                local SUBELEMENTHOLDER = Library:Create("Frame", {
                    Parent = TOGGLECONTAINER,
                    Size = UDim2.new(1,-5,1,0),
                    Position = UDim2.new(0,5,0,0),
                    BackgroundTransparency = 1,
                    Name = "elementholder",
                })
                
                Library:Create("UIListLayout", {
                    Parent = SUBELEMENTHOLDER,
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    FillDirection = Enum.FillDirection.Horizontal,
                    HorizontalAlignment = Enum.HorizontalAlignment.Right,
                    VerticalAlignment = Enum.VerticalAlignment.Center,
                    Padding = UDim.new(0, 10),
                    Name = "elementlayout",
                })
                
                -- Toggle functionality
                Library:connection(TOGGLE.MouseEnter, function()
                    Library:tween(TOGGLE_OUTLINE, {Color = Library.Colors.Accent})
                    local input = Library:connection(_uis.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            toggle.State = not toggle.State
                            options.callback(toggle.State)
                            if toggle.State then
                                Library:tween(TOGGLE, {BackgroundColor3 = Library.Colors.Accent})
                                Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.ElementActive})
                            else
                                Library:tween(TOGGLE, {BackgroundColor3 = Color3.fromRGB(20, 20, 20)})
                                Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.ElementInactive})
                            end
                            if toggle.State and options.risky then
                                Library:tween(TOGGLE, {BackgroundColor3 = Library.Colors.Accent})
                                Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.RiskyActive})
                            elseif options.risky then
                                Library:tween(TOGGLE, {BackgroundColor3 = Color3.fromRGB(20, 20, 20)})
                                Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.RiskyInactive})
                            end
                        end
                    end)
                    local leave
                    leave = Library:connection(TOGGLE.MouseLeave, function()
                        input:Disconnect()
                        leave:Disconnect()
                        Library:tween(TOGGLE_OUTLINE, {Color = Color3.fromRGB(0, 0, 0)})
                    end)
                end)
                
                -- Set initial state
                if toggle.State then
                    Library:tween(TOGGLE, {BackgroundColor3 = Library.Colors.Accent})
                    Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.ElementActive})
                else
                    Library:tween(TOGGLE, {BackgroundColor3 = Color3.fromRGB(20, 20, 20)})
                    Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.ElementInactive})
                end
                
                if toggle.State and options.risky then
                    Library:tween(TOGGLE, {BackgroundColor3 = Library.Colors.Accent})
                    Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.RiskyActive})
                elseif options.risky then
                    Library:tween(TOGGLE, {BackgroundColor3 = Color3.fromRGB(20, 20, 20)})
                    Library:tween(TOGGLETITLE, {TextColor3 = Library.Colors.RiskyInactive})
                end
                
                options.callback(toggle.State)
                
                -- Keybind functionality for toggle
                function toggle:AddKeybind(options)
                    options = Library:validate({
                        default = Enum.KeyCode.Unknown,
                        callback = function(value) end
                    }, options or {})
                
                    local keybind = {
                        Key = options.default,
                        Connection = nil
                    }
                
                    local KEYBINDTEXTBOX = Library:Create("TextBox", {
                        Parent = TOGGLECONTAINER,
                        Size = UDim2.new(0, 25, 0, 14),
                        Position = UDim2.new(1, -30, 0.5, -7),
                        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
                        BorderColor3 = Library.Colors.BorderColor,
                        BackgroundTransparency = 1,
                        TextColor3 = Color3.fromRGB(255, 255, 255),
                        TextSize = 10,
                        FontFace = Library.Font,
                        Text = keybind.Key == Enum.KeyCode.Unknown and "" or keybind.Key.Name or "nil",
                        Name = "KeybindTextBox"
                    })
                
                    local KEYBINDLABEL = Library:Create("TextLabel", {
                        Parent = TOGGLECONTAINER,
                        Size = UDim2.new(0, 25, 0, 10),
                        Position = UDim2.new(1, -25, 0, -5),
                        BackgroundTransparency = 1,
                        TextColor3 = Library.Colors.ElementInactive,
                        TextSize = 8,
                        Text = "Keybind",
                        FontFace = Library.Font,
                        TextXAlignment = Enum.TextXAlignment.Center,
                        Name = "KeybindLabel"
                    })
                
                    Library:Create("UICorner", {
                        Parent = KEYBINDTEXTBOX,
                        CornerRadius = UDim.new(0, 4)
                    })
                
                    -- Keybind methods
                    function keybind:SetKey(k)
                        if k then
                            self.Key = k
                            KEYBINDTEXTBOX.Text = k.Name
                            options.callback(k)
                        else
                            self.Key = Enum.KeyCode.Unknown
                            KEYBINDTEXTBOX.Text = ""
                            options.callback(nil)
                        end
                    end
                
                    function keybind:GetKey()
                        return self.Key == Enum.KeyCode.Unknown and nil or self.Key
                    end
                
                    -- Keybind functionality
                    Library:connection(KEYBINDTEXTBOX.MouseEnter, function()
                        Library:tween(KEYBINDTEXTBOX, {BorderColor3 = Library.Colors.Accent})
                        Library:tween(KEYBINDLABEL, {TextColor3 = Library.Colors.ElementActive})
                    end)
                
                    Library:connection(KEYBINDTEXTBOX.MouseLeave, function()
                        Library:tween(KEYBINDTEXTBOX, {BorderColor3 = Library.Colors.BorderColor})
                        Library:tween(KEYBINDLABEL, {TextColor3 = Library.Colors.ElementInactive})
                    end)
                
                    Library:connection(KEYBINDTEXTBOX.Focused, function()
                        if not keybind.Connection then
                            keybind.Connection = _uis.InputBegan:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.Keyboard then
                                    keybind:SetKey(input.KeyCode)
                                    KEYBINDTEXTBOX:ReleaseFocus()
                                end
                            end)
                        end
                    end)
                
                    Library:connection(KEYBINDTEXTBOX.FocusLost, function(enterPressed)
                        if keybind.Connection then
                            keybind.Connection:Disconnect()
                            keybind.Connection = nil
                        end
                        local text = KEYBINDTEXTBOX.Text:upper()
                        if #text == 1 then
                            local keyCode = Enum.KeyCode[text]
                            if keyCode then
                                keybind:SetKey(keyCode)
                            else
                                keybind:SetKey(nil)
                            end
                        else
                            keybind:SetKey(nil)
                        end
                    end)
                
                    options.callback(keybind:GetKey())
                
                    return keybind
                end
                
                -- Color picker functionality for toggle
                local TweenService = game:GetService("TweenService")
                function toggle:AddColorpicker(options)
                    options = Library:validate({
                        default = Color3.fromRGB(255,255,255),
                        getcolor = function() end,
                        gettransparency = function() end
                    }, options or {})
                
                    local ELEMENT = Library:Create("Frame", {
                        Name = "element",
                        Parent = SUBELEMENTHOLDER,
                        Size = UDim2.new(0, 22, 0, 12),
                        BorderColor3 = Library.Colors.BorderColor,
                        BorderSizePixel = 1,
                    })
                
                    Library:Create("UIGradient", {
                        Name = "UIGradient",
                        Parent = ELEMENT,
                        Color = ColorSequence.new({
                            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
                            ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0)),
                        }),
                        Rotation = 90
                    })
                
                    local COLORPICKER = Library:Create("Frame", {
                        Name = "colorpicker",
                        Parent = TOGGLECONTAINER,
                        Size = UDim2.new(0, 200, 0, 200),
                        Visible = false,
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        Position = UDim2.new(0, -360, 0, -150),
                        BorderSizePixel = 2,
                        BackgroundColor3 = Library.Colors.Window,
                    })
                    
                    local BRIGHTNESS = Library:Create("Frame", {
                        Name = "brightness",
                        Parent = COLORPICKER,
                        Size = UDim2.new(1, -20, 1, -20),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        BorderSizePixel = 2,
                    })
                    
                    local IMAGELABEL = Library:Create("ImageLabel", {
                        Name = "ImageLabel",
                        Parent = BRIGHTNESS,
                        Size = UDim2.new(1, 0, 1, 0),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        BackgroundTransparency = 1,
                        BorderSizePixel = 0,
                        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                        Image = "rbxassetid://2615689005"
                    })
                    
                    local PICKER_BRIGHTNESS = Library:Create("ImageLabel", {
                        Name = "picker",
                        Parent = BRIGHTNESS,
                        Size = UDim2.new(0, 10, 0, 10),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        BackgroundTransparency = 1,
                        BorderSizePixel = 2,
                        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                        Image = "rbxassetid://18268646065",
                        AnchorPoint = Vector2.new(0.5, 0.5)
                    })
                
                    local COPY = Library:Create("Frame", {
                        Parent = COLORPICKER,
                        BackgroundColor3 = Library.Colors.Window,
                        Size = UDim2.new(0.5, -1, 0, 14),
                        Position = UDim2.new(0, -6, 0, -23),
                        BorderSizePixel = 0
                    })
                    
                    local COPYTEXT = Library:Create("TextLabel", {
                        Parent = COPY,
                        Size = UDim2.new(1, 0, 1, 0),
                        BackgroundTransparency = 1,
                        TextColor3 = Color3.fromRGB(255,255,255),
                        TextSize = 9,
                        Text = "copy",
                        FontFace = Library.Font,
                        TextXAlignment = Enum.TextXAlignment.Center,
                        BorderSizePixel = 0
                    })
                    
                    local PASTE = Library:Create("Frame", {
                        Parent = COLORPICKER,
                        BackgroundColor3 = Library.Colors.Window,
                        Size = UDim2.new(0.5, -1, 0, 14),
                        Position = UDim2.new(1, 6, 0, -23),
                        AnchorPoint = Vector2.new(1, 0),
                        BorderSizePixel = 0
                    })
                    
                    local PASTETEXT = Library:Create("TextBox", {
                        Parent = PASTE,
                        BackgroundTransparency = 1,
                        Size = UDim2.new(1, 0, 1, 0),
                        BorderSizePixel = 0,
                        Selectable = false,
                        FontFace = Library.Font,
                        TextColor3 = Color3.fromRGB(255,255,255),
                        TextSize = 9,
                        TextStrokeTransparency = 0,
                        TextXAlignment = Enum.TextXAlignment.Center,
                    })
                
                    Library:Create("UIPadding", {
                        Name = "UIPadding",
                        Parent = COLORPICKER,
                        PaddingBottom = UDim.new(0, 5),
                        PaddingTop = UDim.new(0, 5),
                        PaddingLeft = UDim.new(0, 5),
                        PaddingRight = UDim.new(0, 5)
                    })
                    
                    local HUE = Library:Create("ImageLabel", {
                        Name = "hue",
                        Parent = COLORPICKER,
                        AnchorPoint = Vector2.new(1, 0),
                        Size = UDim2.new(0, 15, 1, -20),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        Position = UDim2.new(1, 0, 0, 0),
                        BorderSizePixel = 2,
                        Image = "rbxassetid://2615692420",
                    })
                    
                    local PICKER_HUE = Library:Create("Frame", {
                        Name = "picker",
                        Parent = HUE,
                        Size = UDim2.new(1, 0, 0, 1),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        Position = UDim2.new(0, 0, 0, 0),
                        BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                    })
                    
                    local TRANSPARENCY = Library:Create("ImageLabel", {
                        Name = "transparency",
                        Parent = COLORPICKER,
                        AnchorPoint = Vector2.new(0, 1),
                        Size = UDim2.new(1, -20, 0, 15),
                        BackgroundTransparency = 1,
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        Position = UDim2.new(0, 0, 1, 0),
                        BorderSizePixel = 2,
                        Image = "rbxassetid://18294288954"
                    })
                    
                    local PICKER_TRANSPARENCY = Library:Create("Frame", {
                        Name = "picker",
                        Parent = TRANSPARENCY,
                        Size = UDim2.new(0, 1, 1, 0),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                    })
                
                    local PREVIEW = Library:Create("Frame", {
                        Name = "preview",
                        Parent = COLORPICKER,
                        AnchorPoint = Vector2.new(1, 1),
                        Size = UDim2.new(0, 15, 0, 15),
                        BorderColor3 = Color3.fromRGB(0, 0, 0),
                        Position = UDim2.new(1, 0, 1, 0),
                        BorderSizePixel = 2,
                    })
                    
                    Library:Create("UIGradient", {
                        Name = "UIGradient",
                        Parent = PREVIEW,
                        Color = ColorSequence.new({
                            ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
                            ColorSequenceKeypoint.new(0.8, Color3.fromRGB(230, 230, 230)),
                            ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 255, 255))
                        }),
                        Rotation = 45
                    })
                
                    -- Color picker hover effects
                    Library:connection(ELEMENT.MouseEnter, function()
                        Library:tween(ELEMENT, {BorderColor3 = Library.Colors.Accent})
                    end)
                    
                    Library:connection(ELEMENT.MouseLeave, function()
                        Library:tween(ELEMENT, {BorderColor3 = Library.Colors.BorderColor})
                    end)
                
                    -- Toggle color picker visibility
                    local elhovered = false
                    Library:connection(ELEMENT.MouseEnter, function()
                        elhovered = true
                    end)
                    
                    Library:connection(ELEMENT.MouseLeave, function()
                        elhovered = false
                    end)
                
                    Library:connection(_uis.InputBegan, function(input)
                        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and elhovered then
                            for i, v in pairs(SCREENGUI:GetDescendants()) do
                                if v.Name == "colorpicker" and v.Visible and v ~= COLORPICKER then 
                                    v.Visible = false
                                end
                            end
                            COLORPICKER.Visible = not COLORPICKER.Visible
                            ELEMENT.BorderColor3 = Library.Colors.BorderColor
                        end
                    end)
                    
                    local lastHue, lastSaturation 
                    local absvalue
                    
                    local function updateValue(value)
                        options.default = value
                        ELEMENT.BackgroundColor3 = value
                        PREVIEW.BackgroundColor3 = value
                        local r, g, b = math.round(value.r * 255), math.round(value.g * 255), math.round(value.b * 255)
                        PASTETEXT.Text = tostring(r) .. "," .. tostring(g) .. "," .. tostring(b)
                        absvalue = tostring(r) .. "," .. tostring(g) .. "," .. tostring(b)
                        options.getcolor(value)
                        
                        -- Store hue and saturation when value > 0
                        local h, s, v = Color3.toHSV(value)
                        if v > 0 then
                            lastHue = h
                            lastSaturation = s
                        end
                        
                        -- Update brightness slider position based on value
                        local brightnessPercent = v
                        PICKER_TRANSPARENCY.Position = UDim2.new(0, brightnessPercent * TRANSPARENCY.AbsoluteSize.X, 0, 0)
                        
                        -- Update hue slider position
                        local huePercent = h
                        PICKER_HUE.Position = UDim2.new(0, 0, 0, huePercent * HUE.AbsoluteSize.Y)
                    end
                    
                    -- Color picker variables and helper functions
                    local white, black = Color3.new(1,1,1), Color3.new(0,0,0)
                    local colors = {Color3.new(1,0,0), Color3.new(1,1,0), Color3.new(0,1,0), Color3.new(0,1,1), Color3.new(0,0,1), Color3.new(1,0,1), Color3.new(1,0,0)}
                    local oldpercentX, oldpercentY = 0, 0
                
                    -- Common tween function for all pickers
                    local function tweenPicker(picker, newPos, duration)
                        local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
                        local tween = TweenService:Create(picker, tweenInfo, {Position = newPos})
                        tween:Play()
                    end
                    
                    local function updatePickerPosition(x, y)
                        local offsetX = x - BRIGHTNESS.AbsolutePosition.X
                        local offsetY = y - BRIGHTNESS.AbsolutePosition.Y
                        
                        offsetX = math.clamp(offsetX, 0, BRIGHTNESS.AbsoluteSize.X)
                        offsetY = math.clamp(offsetY, 0, BRIGHTNESS.AbsoluteSize.Y)
                        
                        PICKER_BRIGHTNESS.Position = UDim2.new(0, offsetX, 0, offsetY)
                        
                        local saturation = offsetX / BRIGHTNESS.AbsoluteSize.X
                        local value = 1 - (offsetY / BRIGHTNESS.AbsoluteSize.Y)
                        
                        local hueColor = BRIGHTNESS.BackgroundColor3
                        local h, s, v = Color3.toHSV(hueColor)
                        local color = Color3.fromHSV(h, saturation, value)
                        
                        updateValue(color)
                    end
 
                    Library:connection(BRIGHTNESS.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            local function update(x, y)
                                updatePickerPosition(x, y)
                            end
                            
                            -- Update immediately on mouse press
                            update(input.Position.X, input.Position.Y)
                            
                            -- Track mouse movement
                            local draggingConnection = _uis.InputChanged:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                                    update(input.Position.X, input.Position.Y)
                                end
                            end)
                            
                            -- Disconnect when mouse is released
                            local endConnection
                            endConnection = _uis.InputEnded:Connect(function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                                    draggingConnection:Disconnect()
                                    endConnection:Disconnect()
                                end
                            end)
                        end
                    end)
                
                    Library:connection(HUE.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            local function updateHuePosition(y)
                                local offsetY = y - HUE.AbsolutePosition.Y
                                offsetY = math.clamp(offsetY, 0, HUE.AbsoluteSize.Y)
                                local percent = offsetY / HUE.AbsoluteSize.Y
                                local hue = percent * 360
                                local color = Color3.fromHSV(hue / 360, lastSaturation or 1, 1)
                                BRIGHTNESS.BackgroundColor3 = color
                                PICKER_HUE.Position = UDim2.new(0, 0, 0, offsetY)
                                
                                local saturation = PICKER_BRIGHTNESS.Position.X.Offset / BRIGHTNESS.AbsoluteSize.X
                                local value = 1 - (PICKER_BRIGHTNESS.Position.Y.Offset / BRIGHTNESS.AbsoluteSize.Y)
                                local finalColor = Color3.fromHSV(hue / 360, saturation, value)
                                updateValue(finalColor)
                            end
                            
                            updateHuePosition(input.Position.Y)
                            
                            local draggingConnection = Library:connection(_uis.InputChanged, function(input)
                                if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                                    updateHuePosition(input.Position.Y)
                                end
                            end)
                            
                            local endConnection
                            endConnection = Library:connection(_uis.InputEnded, function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                                    draggingConnection:Disconnect()
                                    endConnection:Disconnect()
                                end
                            end)
                        end
                    end)
                    
                    local function updateBrightnessSlider(x)
                        local offsetX = x - TRANSPARENCY.AbsolutePosition.X
                        offsetX = math.clamp(offsetX, 0, TRANSPARENCY.AbsoluteSize.X)
                        local percent = offsetX / TRANSPARENCY.AbsoluteSize.X
                        PICKER_TRANSPARENCY.Position = UDim2.new(0, offsetX, 0, 0)
                        
                        -- Get current color from PREVIEW
                        local currentColor = PREVIEW.BackgroundColor3 or Color3.new(1, 1, 1)
                        local h, s, v = Color3.toHSV(currentColor)
                        
                        -- Store original hue and saturation if value > 0
                        if v > 0 then
                            lastHue = h
                            lastSaturation = s
                        end
                        
                        -- Calculate new value from slider
                        local newValue = percent
                        
                        -- Create new color using original hue and saturation if available
                        local newColor = Color3.fromHSV(lastHue or h, lastSaturation or s, newValue)
                        
                        -- Update color
                        updateValue(newColor)
                    end
                    
                    Library:connection(TRANSPARENCY.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            updateBrightnessSlider(input.Position.X)
                            
                            local draggingConnection = Library:connection(_uis.InputChanged, function(input)
                                if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                                    updateBrightnessSlider(input.Position.X)
                                end
                            end)
                            
                            local endConnection
                            endConnection = Library:connection(_uis.InputEnded, function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                                    draggingConnection:Disconnect()
                                    endConnection:Disconnect()
                                end
                            end)
                        end
                    end)
                    
                    Library:connection(PICKER_TRANSPARENCY.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            updateBrightnessSlider(input.Position.X)
                            
                            local draggingConnection = Library:connection(_uis.InputChanged, function(input)
                                if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                                    updateBrightnessSlider(input.Position.X)
                                end
                            end)
                            
                            local endConnection
                            endConnection = Library:connection(_uis.InputEnded, function(input)
                                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                                    draggingConnection:Disconnect()
                                    endConnection:Disconnect()
                                end
                            end)
                        end
                    end)
                    
                    Library:connection(COPY.MouseEnter, function()
                        Library:tween(COPYTEXT, {TextColor3 = Library.Colors.Accent})
                        local input = Library:connection(_uis.InputBegan, function(input)
                            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                                setclipboard(absvalue)
                            end
                        end)
                        local leave
                        leave = Library:connection(COPY.MouseLeave, function()
                            Library:tween(COPYTEXT, {TextColor3 = Color3.fromRGB(255,255,255)})
                            input:Disconnect()
                            leave:Disconnect()
                        end)
                    end)
                
                    Library:connection(PASTE.MouseEnter, function()
                        Library:tween(PASTETEXT, {TextColor3 = Library.Colors.Accent})
                        local leave
                        leave = Library:connection(PASTE.MouseLeave, function()
                            Library:tween(PASTETEXT, {TextColor3 = Color3.fromRGB(255,255,255)})
                            leave:Disconnect()
                        end)
                    end)
                
                    Library:connection(PASTETEXT.FocusLost, function(enterPressed)
                        if enterPressed then
                            local r, g, b = string.match(PASTETEXT.Text, "(%d+),(%d+),(%d+)")
                            if r and g and b then
                                local color = Color3.fromRGB(tonumber(r), tonumber(g), tonumber(b))
                                updateValue(color)
                                BRIGHTNESS.BackgroundColor3 = color
                                PASTETEXT.Text = r .. "," .. g .. "," .. b
                            end
                        end
                    end)
                
                    -- Initialize with default value
                    updateValue(options.default or Color3.new(1, 1, 1))
                end
                
                return toggle
            end
            
            -- Slider element
            function section:AddSlider(options)
                options = Library:validate({
                    name = "example slider",
                    default = 50,
                    suffix = "",
                    changeby = 5,
                    min = 0,
                    max = 100,
                    callback = function(value) end
                }, options or {})
                
                local slider = {
                    MouseDown = false,
                    Hover = false,
                    Dragging = false,
                    Connection = nil
                }
                
                if not _G.isDraggingSlider then
                    _G.isDraggingSlider = false
                end
                
                local uis = game:GetService("UserInputService")
                local cas = game:GetService("ContextActionService")
                
                options.value = 0
                if options.min then
                    if options.default < options.min then
                        options.default = options.min
                    end
                end
                
                local SLIDERCONTAINER = Library:Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 20),
                    Parent = ELEMENTCONTAINER,
                    BackgroundTransparency = 1,
                    Name = "SliderContainer"
                })
                
                local SLIDERTITLE = Library:Create("TextLabel", {
                    Parent = SLIDERCONTAINER,
                    Size = UDim2.new(1, -2, 1, -15),
                    Position = UDim2.new(0, 2, 0, 0),
                    BackgroundTransparency = 1,
                    TextColor3 = Library.Colors.ElementInactive,
                    TextSize = 9,
                    Text = options.name,
                    FontFace = Library.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Name = "SliderTitle"
                })
                
                local SLIDERBACK = Library:Create("Frame", {
                    Parent = SLIDERCONTAINER,
                    Size = UDim2.new(1, -60, 0, 6),
                    AnchorPoint = Vector2.new(0, 1),
                    Position = UDim2.new(0, 0, 1, 0),
                    BackgroundColor3 = Color3.fromRGB(25, 25, 25),
                    BorderSizePixel = 0,
                    Name = "SliderBack",
                })
                
                local STROKE = Library:Create("UIStroke", {
                    Parent = SLIDERBACK,
                    Thickness = 1,
                    Color = Color3.fromRGB(0, 0, 0),
                    LineJoinMode = Enum.LineJoinMode.Miter,
                    Name = "UIStrokeBackSlider",
                    Transparency = 0
                })
                
                Library:Create("UICorner", {
                    Parent = SLIDERBACK,
                    CornerRadius = UDim.new(0, 4)
                })
                
                local SLIDER = Library:Create("Frame", {
                    Parent = SLIDERBACK,
                    Size = UDim2.new(1, -80, 1, 0),
                    Name = "Slider",
                    ZIndex = 1,
                    BorderSizePixel = 0
                })
                
                Library:Create("UIGradient", {
                    Parent = SLIDER,
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0.00, Library.Colors.Accent),
                        ColorSequenceKeypoint.new(1.00, Color3.fromRGB(27, 27, 55))
                    },
                    Rotation = 90,
                })
                
                local SLIDERVALUE = Library:Create("TextLabel", {
                    Size = UDim2.new(0, 20, 0, 10),
                    Parent = SLIDER,
                    TextXAlignment = Enum.TextXAlignment.Center,
                    Position = UDim2.new(1, -10, 0, -15),
                    BackgroundTransparency = 1,
                    TextColor3 = Library.Colors.ElementInactive,
                    FontFace = Library.Font,
                    Text = math.round(options.value),
                    TextTransparency = 1,
                    TextSize = 8,
                    Name = options.name
                })
                
                Library:Create("UIStroke", {
                    Thickness = 1,
                    Color = Color3.new(0, 0, 0),
                    Parent = SLIDERVALUE
                })
                
                local TEXTBOX = Library:Create("TextBox", {
                    Parent = SLIDERCONTAINER,
                    Size = UDim2.new(0, 50, 0, 14),
                    Position = UDim2.new(1, -55, 0.5, -7),
                    BackgroundTransparency = 1,
                    BorderSizePixel = 0,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 10,
                    FontFace = Library.Font,
                    Text = tostring(options.default),
                    Name = "SliderTextBox"
                })
                
                Library:Create("UICorner", {
                    Parent = TEXTBOX,
                    CornerRadius = UDim.new(0, 4)
                })
                
                -- Slider methods
                function slider:SetValue(v)
                    local slidervalue
                    if v == nil then
                        local mouseX = mouse.X
                        if mouseX >= SLIDERBACK.AbsolutePosition.X and mouseX <= (SLIDERBACK.AbsolutePosition.X + SLIDERBACK.AbsoluteSize.X) then
                            local output = (mouseX - SLIDERBACK.AbsolutePosition.X) / SLIDERBACK.AbsoluteSize.X
                            slidervalue = math.clamp(math.round(output * (options.max - options.min) + options.min), options.min, options.max)
                        else
                            return
                        end
                    else
                        if v and tonumber(v) then
                            slidervalue = math.clamp(math.round(v), options.min, options.max)
                        else
                            slidervalue = 0
                        end
                    end
                    SLIDERVALUE.Text = slidervalue .. (options.suffix or "")
                    SLIDER:TweenSize(UDim2.fromScale((slidervalue - options.min) / (options.max - options.min), 1), Enum.EasingDirection.In, Enum.EasingStyle.Linear, 0.1, true)
                    TEXTBOX.Text = slidervalue
                    options.callback(slider:GetValue())
                end
                    
                function slider:GetValue()
                    local text = TEXTBOX.Text
                    if text == "" or not tonumber(text) then
                        return nil
                    end
                    return tonumber(text)
                end
                
                -- Initialize slider
                SLIDER.Size = UDim2.fromScale((options.default - options.min) / (options.max - options.min), 1)
                SLIDERVALUE.Text = options.default .. (options.suffix or "")
                TEXTBOX.Text = options.default
                
                -- Slider functionality
                do
                    local function blockCameraInput(_, inputState)
                        if slider.Dragging then
                            return Enum.ContextActionResult.Sink
                        end
                        return Enum.ContextActionResult.Pass
                    end
                
                    Library:connection(SLIDERBACK.MouseEnter, function()
                        slider.Hover = true
                        Library:tween(SLIDERTITLE, {TextColor3 = Library.Colors.ElementActive})
                    end)
                
                    Library:connection(SLIDERBACK.MouseLeave, function()
                        slider.Hover = false
                        if not slider.Dragging then
                            Library:tween(SLIDERTITLE, {TextColor3 = Library.Colors.ElementInactive})
                        end
                    end)
                
                    Library:connection(SLIDERBACK.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            slider.Dragging = true
                            _G.isDraggingSlider = true
                            uis.MouseBehavior = Enum.MouseBehavior.LockCurrentPosition
                            cas:BindAction("BlockCamera", blockCameraInput, false, Enum.UserInputType.MouseMovement)
                            Library:tween(STROKE, {Color = Library.Colors.Accent, Transparency = 0})
                            Library:tween(SLIDERVALUE, {TextColor3 = Library.Colors.Accent, TextTransparency = 0})
                            slider:SetValue()
                        end
                    end)
                
                    Library:connection(SLIDERBACK.InputChanged, function(input)
                        if slider.Dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                            slider:SetValue()
                        end
                    end)
                
                    Library:connection(_uis.InputEnded, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            slider.Dragging = false
                            _G.isDraggingSlider = false
                            uis.MouseBehavior = Enum.MouseBehavior.Default
                            cas:UnbindAction("BlockCamera")
                            Library:tween(STROKE, {Color = Color3.fromRGB(0, 0, 0), Transparency = 0})
                            Library:tween(SLIDERVALUE, {TextTransparency = 1})
                            Library:tween(SLIDERTITLE, {TextColor3 = Library.Colors.ElementInactive})
                        end
                    end)
                
                    Library:connection(TEXTBOX.FocusLost, function(enterPressed)
                        if enterPressed then
                            slider:SetValue(TEXTBOX.Text)
                        end
                    end)
                
                    Library:connection(TEXTBOX.MouseEnter, function()
                        Library:tween(TEXTBOX, {BorderColor3 = Library.Colors.Accent})
                    end)
                
                    Library:connection(TEXTBOX.MouseLeave, function()
                        Library:tween(TEXTBOX, {BorderColor3 = Library.Colors.BorderColor})
                    end)
                end
                
                options.callback(slider:GetValue())
                
                return slider
            end
            
-- Trong function section:AddDropdown, thay th bng phin bn ci tin ny
-- Thay th hm AddDropdown bng phin bn n gin hn
function section:AddDropdown(options)
    options = Library:validate({
        name = "example dropdown",
        list = {"example 1", "example 2", "example 3", "example 4"},
        multi = true,
        max = 3,
        default = nil,
        callback = function(active) end
    }, options or {})
    
    dropdownindex = dropdownindex - 1
    
    -- X l default value
    local defaultValue = options.list[1] -- Mc nh l phn t u tin
    if options.default then
        if type(options.default) == "string" then
            -- Tm trong list
            for _, v in ipairs(options.list) do
                if v == options.default then
                    defaultValue = v
                    break
                end
            end
        elseif type(options.default) == "number" then
            -- m bo trong phm vi
            defaultValue = options.list[math.max(1, math.min(options.default, #options.list))]
        end
    end
    
    local dropdown = {
        Hover = false,
        active = options.multi and {defaultValue} or defaultValue,
        state = false,
        multi = options.multi,
        currentSelection = defaultValue
    }
    
    local DROPDOWNCONTAINER = Library:Create("Frame", {
        Parent = ELEMENTCONTAINER,
        Size = UDim2.new(1, 0, 0, 30),
        Name = options.name,
        BorderSizePixel = 0,
        BackgroundTransparency = 1,
    })
    
    local DROPDOWNTEXT = Library:Create("TextLabel", {
        Size = UDim2.new(1,0,1,-20),
        Parent = DROPDOWNCONTAINER,
        Position = UDim2.new(0, 2, 0, -1),
        BackgroundTransparency = 1,
        TextXAlignment = Enum.TextXAlignment.Left,
        FontFace = Library.Font,
        Text = options.name,
        TextColor3 = Library.Colors.ElementActive,
        TextSize = 9,
        Name = options.name
    })
    
    local ACTIVECHOICE = Library:Create("TextButton", { -- Thay i thnh TextButton  d x l click
        Size = UDim2.new(1,0,0,15),
        AnchorPoint = Vector2.new(0.5, 0),
        Position = UDim2.new(0.5, 0, 0, 13),
        Parent = DROPDOWNCONTAINER,
        BorderSizePixel = 1,
        BackgroundColor3 = Color3.fromRGB(20,20,20),
        BorderColor3 = Library.Colors.BorderColor,
        Name = "ActiveChoice",
        ZIndex = dropdownindex + 5,
        Text = "", --  trng text
        AutoButtonColor = false -- Tt hiu ng mu mc nh
    })
    
    Library:Create("UIGradient", { 
        Parent = ACTIVECHOICE,
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(175, 175, 175)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(145, 145, 145))
        },
        Rotation = 90,
    })
    
    local ACTIVETEXT = Library:Create("TextLabel", {
        Size = UDim2.new(1,0,0,0),
        Parent = ACTIVECHOICE,
        Position = UDim2.new(0.5, 0, 0, 8),
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundTransparency = 1,
        TextXAlignment = Enum.TextXAlignment.Center,
        FontFace = Library.Font,
        Text = defaultValue or "",
        TextColor3 = Library.Colors.ElementInactive,
        TextSize = 9,
        Name = "DropdownText",
        ZIndex = dropdownindex + 5,
    })
    
    local CHOICEHOLDER = Library:Create("Frame", {
        Size = UDim2.new(1, -1, 0, 0),
        Position = UDim2.new(0, 0, 0, 14),
        Parent = ACTIVECHOICE,
        BackgroundTransparency = 1,
        Visible = false,
        BorderSizePixel = 0,
        ZIndex = dropdownindex + 5,
    })
    
    Library:Create("UIListLayout", {
        Parent = CHOICEHOLDER,
        SortOrder = Enum.SortOrder.LayoutOrder,
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        Padding = UDim.new(0, 0),
        Name = "ChoiceLayout",
    })
    
    -- Thm mt nt v hnh  chn u vo khi dropdown m
    local BLOCKINPUT = Library:Create("TextButton", {
        Parent = SCREENGUI,
        Size = UDim2.new(1, 0, 1, 0),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1,
        Text = "",
        Visible = false,
        ZIndex = dropdownindex + 4,
        Name = "BlockInput_" .. options.name
    })
    
    -- Hm  chn mt la chn
    local function selectChoice(name)
        print("selectChoice called with:", name)
        
        dropdown.active = name
        dropdown.currentSelection = name
        ACTIVETEXT.Text = name
        print("Selected method:", name)
        
        -- Gi callback vi gi tr mi
        options.callback(name)
        
        -- ng dropdown
        dropdown.state = false
        Library:tween(ACTIVETEXT, {TextColor3 = Library.Colors.ElementInactive})
        CHOICEHOLDER.Visible = false
        BLOCKINPUT.Visible = false
    end
    
    -- Thm cc la chn
    for _, name in ipairs(options.list) do
        local CHOICE = Library:Create("TextButton", {
            Size = UDim2.new(1,-2,0,15),
            Parent = CHOICEHOLDER,
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = Library.Colors.ElementInactive,
            TextSize = 8,
            FontFace = Library.Font,
            ZIndex = dropdownindex + 5,
            AutoButtonColor = false
        })
        
        -- Highlight la chn hin ti
        if name == defaultValue then
            CHOICE.TextColor3 = Library.Colors.Accent
        end
        
        -- X l click
        CHOICE.MouseButton1Click:Connect(function()
            print("Clicked on:", name)
            selectChoice(name)
        end)
        
        -- X l hover
        CHOICE.MouseEnter:Connect(function()
            if name ~= dropdown.currentSelection then
                CHOICE.TextColor3 = Library.Colors.ElementActive
            end
        end)
        
        CHOICE.MouseLeave:Connect(function()
            if name ~= dropdown.currentSelection then
                CHOICE.TextColor3 = Library.Colors.ElementInactive
            end
        end)
    end
    
    -- X l click vo dropdown chnh
    ACTIVECHOICE.MouseButton1Click:Connect(function()
        dropdown.state = not dropdown.state
        
        if dropdown.state then
            -- M dropdown
            Library:tween(ACTIVETEXT, {TextColor3 = Library.Colors.ElementActive})
            CHOICEHOLDER.Visible = true
            
            -- Tnh ton kch thc
            local height = 0
            for _, choice in ipairs(CHOICEHOLDER:GetChildren()) do
                if choice:IsA("TextButton") then
                    height = height + 15
                end
            end
            
            CHOICEHOLDER.Size = UDim2.new(1, -1, 0, math.min(height, 150))
            BLOCKINPUT.Visible = true
        else
            -- ng dropdown
            Library:tween(ACTIVETEXT, {TextColor3 = Library.Colors.ElementInactive})
            CHOICEHOLDER.Visible = false
            BLOCKINPUT.Visible = false
        end
    end)
    
    -- X l click vo nt chn
    BLOCKINPUT.MouseButton1Click:Connect(function()
        dropdown.state = false
        Library:tween(ACTIVETEXT, {TextColor3 = Library.Colors.ElementInactive})
        CHOICEHOLDER.Visible = false
        BLOCKINPUT.Visible = false
    end)
    
    -- Gi callback vi gi tr mc nh
    print("Initial callback with:", defaultValue)
    options.callback(defaultValue)
    
    return dropdown
end
            -- List element
            function section:AddList(options)
                options = Library:validate({
                    default = 1,
                    list = {"example 1", "example 2", "example 3", "example 4", "example 5", "example 6", "example 7", "example 8", "example 9", "example 10"},
                    callback = function(active) end
                }, options or {})
                
                options.default = options.default or 1
                
                local List = {
                    CurrentChoice = nil
                }
                
                local LISTCONTAINER = Library:Create("Frame", {
                    Parent = ELEMENTCONTAINER,
                    Size = UDim2.new(1, 0, 0, 100),
                    Name = options.name,
                    BorderSizePixel = 1,
                    BorderColor3 = Color3.fromRGB(255,255,255),
                    BackgroundTransparency = 0,
                })
                
                Library:Create("UIGradient", {
                    Parent = LISTCONTAINER,
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(50, 50, 50)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 20))
                    },
                    Rotation = 90,
                })
                
                local CHOICEHOLDER = Library:Create("ScrollingFrame", {
                    Parent = LISTCONTAINER,
                    Size = UDim2.new(1,0,1,0),
                    CanvasSize = UDim2.new(0,0,10,0),
                    BackgroundTransparency = 1,
                    ScrollBarThickness = 0,
                })
                
                Library:Create("UIListLayout", {
                    Parent = CHOICEHOLDER,
                    FillDirection = Enum.FillDirection.Vertical,
                    HorizontalAlignment = Enum.HorizontalAlignment.Center,
                    VerticalAlignment = Enum.VerticalAlignment.Top,
                    Padding = UDim.new(0, 4),
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    Name = "ListLayout"
                })
                
                local TRANSPARENCYEFFECT = Library:Create("Frame",{
                    Parent = LISTCONTAINER,
                    Size = UDim2.new(1,0,1,0),
                    BackgroundColor3 = Color3.fromRGB(0,0,0),
                    BorderSizePixel = 0,
                    ZIndex = 2,
                })
                
                Library:Create("UIGradient", {
                    Parent = TRANSPARENCYEFFECT,
                    Transparency = NumberSequence.new({
                        NumberSequenceKeypoint.new(0, 1),
                        NumberSequenceKeypoint.new(0.8, 0.6),
                        NumberSequenceKeypoint.new(1, 0),
                    }),
                    Rotation = 90
                })
                
                Library:connection(CHOICEHOLDER.MouseEnter, function()
                    List.MouseInside = true
                end)
    
                Library:connection(CHOICEHOLDER.MouseLeave, function()
                    List.MouseInside = false
                end)
                
                function List:AddChoice(name)
                    local CHOICE = Library:Create("Frame", {
                        Size = UDim2.new(1,-2,0,15),
                        Parent = CHOICEHOLDER,
                        AnchorPoint = Vector2.new(0.5,0),
                        BackgroundTransparency = 1,
                        BorderSizePixel = 0,
                        ZIndex = 100,
                    })
            
                    local CHOICETEXT = Library:Create("TextLabel", {
                        Size = UDim2.new(1,0,1,0),
                        Parent = CHOICE,
                        AnchorPoint = Vector2.new(0.5,0),
                        Position = UDim2.new(0.5, 0, 0, 0),
                        BackgroundTransparency = 1,
                        FontFace = Library.Font,
                        Text = name,
                        TextColor3 = Library.Colors.ElementInactive,
                        TextSize = 8,
                        Name = name,
                    })
                    
                    local CHOICEBAR = Library:Create("Frame", {
                        Parent = CHOICE,
                        Size = UDim2.new(0,0,0,1),
                        AnchorPoint = Vector2.new(0.5, 0.5),
                        Position = UDim2.new(0.5, 0, 0.5, 5),
                        BackgroundTransparency = 0.5,
                        BackgroundColor3 = Library.Colors.Accent,
                        BorderSizePixel = 0
                    })
                    
                    -- Choice functionality
                    local choice = {
                        Name = name,
                        Hover = false,
                        Active = false,
                    }
                    
                    if List[default] == choice.Name then 
                        choice.Active = true 
                    end
                    
                    Library:connection(CHOICE.MouseEnter, function()
                        if List.CurrentChoice ~= choice.Name then
                            Library:tween(CHOICETEXT, {TextColor3 = Library.Colors.Accent})
                            Library:tween(CHOICEBAR, {Size = UDim2.new(0,35,0,1)})
                        end
                        choice.Hover = true
                    end)
                    
                    Library:connection(CHOICE.MouseLeave, function()
                        if List.CurrentChoice ~= choice.Name then
                            Library:tween(CHOICETEXT, {TextColor3 = Library.Colors.ElementInactive})
                            Library:tween(CHOICEBAR, {Size = UDim2.new(0,0,0,1)})
                        end
                        choice.Hover = false
                    end)
                    
                    Library:connection(_uis.InputBegan, function(input)
                        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                            if choice.Hover then
                                Library:tween(CHOICETEXT, {TextColor3 = Library.Colors.Accent})
                                Library:tween(CHOICEBAR, {Size = UDim2.new(0,35,0,1)})
                                List.CurrentChoice = choice.Name
                                options.callback(choice.Name)
                            elseif List.MouseInside then
                                Library:tween(CHOICETEXT, {TextColor3 = Library.Colors.ElementInactive})
                                Library:tween(CHOICEBAR, {Size = UDim2.new(0,0,0,1)})
                            end
                        end
                    end)
                end
                
                -- Add default choices
                for _,v in pairs(options.list) do
                    List:AddChoice(v)
                end
                
                return section
            end
            
            return section
        end
        
        return tab
    end
    
    -- Developer tools
    do
        -- Open / Close functionality
        _uis.MouseIconEnabled = false
        Library:connection(_uis.InputBegan, function(input)
            if input.KeyCode == Library.Ui_Bind then
                SCREENGUI.Enabled = not SCREENGUI.Enabled
                _uis.MouseIconEnabled = not SCREENGUI.Enabled
            end
        end)
        
        -- Destroy functionality
        Library:connection(_uis.InputBegan, function(input)
            if input.KeyCode == Enum.KeyCode.Delete then
                Library:unload()
            end
        end)
    end
    
    -- Custom mouse cursor
    do
        local CURSOR = Library:Create("ImageLabel", {
            Size = UDim2.new(0, 18, 0, 18),
            BackgroundTransparency = 1,
            ImageColor3 = Library.Colors.Accent,
            Image = "rbxassetid://17404277477",
            ZIndex = 100,
            Parent = SCREENGUI,
        })
        
        Library:connection(_runservice.RenderStepped, function() 
            CURSOR.Position = UDim2.new(0, mouse.X -6, 0, mouse.Y - 2) 
        end)
    end
    
    -- Window dragging functionality
    do
        local dragging = false
        local dragInput
        local dragStartPos
        local startPos
    
        local function updateInput(input)
            local delta = input.Position - dragStartPos
            local newX = startPos.X.Offset + delta.X
            local newY = startPos.Y.Offset + delta.Y
            WINDOW.Position = UDim2.new(startPos.X.Scale, newX, startPos.Y.Scale, newY)
        end
    
        Library:connection(INNERCONTAINER.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                if not _G.isDraggingSlider then
                    dragging = true
                    dragInput = input
                    dragStartPos = input.Position
                    startPos = WINDOW.Position
                end
            end
        end)
    
        Library:connection(_uis.InputChanged, function(input)
            if dragging and input == dragInput and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                updateInput(input)
            end
        end)
    
        Library:connection(_uis.InputEnded, function(input)
            if input == dragInput and (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
                dragging = false
                dragInput = nil
            end
        end)
    end
    
    return menu
end 

return ab.AddWindow()
